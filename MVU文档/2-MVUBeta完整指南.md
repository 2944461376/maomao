# MVU Beta å®Œæ•´æŒ‡å—

> **MVU Beta** - å¯¹ MVU çš„å¤§è§„æ¨¡æ”¹è‰¯  
> æ–°å¢åŠŸèƒ½ï¼šå¯å˜ç»“æ„ã€æ•°æ®ä¿æŠ¤ã€å¤šè¾“å…¥å½¢å¼å…¼å®¹ã€æ•°å­¦è¿ç®—  
> ä½œè€…ï¼šMagicalAstrogy (MAGè€å¸ˆ)ã€æ³¢æ•°æ¶µè€å¸ˆ  
> æ•™ç¨‹æ•´ç†ï¼šç§‹é’å­

---

## ğŸ“š ç›®å½•

1. [MVU Beta æ¦‚è¿°](#mvu-beta-æ¦‚è¿°)
2. [æ–°å¢çš„å˜é‡æ“ä½œå‘½ä»¤](#æ–°å¢çš„å˜é‡æ“ä½œå‘½ä»¤)
3. [æ•°æ®ç»“æ„å®‰å…¨](#æ•°æ®ç»“æ„å®‰å…¨)
4. [æ•°å­¦è¿ç®—æ”¯æŒ](#æ•°å­¦è¿ç®—æ”¯æŒ)
5. [[value, description] ç»“æ„è§„èŒƒ](#value-description-ç»“æ„è§„èŒƒ)
6. [æ¨èçš„æç¤ºè¯æ¨¡æ¿](#æ¨èçš„æç¤ºè¯æ¨¡æ¿)
7. [StrictSet é…ç½®](#strictset-é…ç½®)
8. [å®Œæ•´æ ¼å¼è¯´æ˜](#å®Œæ•´æ ¼å¼è¯´æ˜)
9. [å®æˆ˜ç¤ºä¾‹](#å®æˆ˜ç¤ºä¾‹)
10. [å¸¸è§é—®é¢˜è§£ç­”](#å¸¸è§é—®é¢˜è§£ç­”)

---

## MVU Beta æ¦‚è¿°

### ä»€ä¹ˆæ˜¯ MVU Betaï¼Ÿ

MVU Beta æ˜¯å¯¹åŸç‰ˆ MVU çš„å¤§è§„æ¨¡æ”¹è‰¯ï¼Œä¸»è¦å¢å¼ºäº†ä»¥ä¸‹æ–¹é¢ï¼š

âœ¨ **æ ¸å¿ƒæ”¹è¿›**ï¼š
1. **æ–°å¢å‘½ä»¤**ï¼š`_.add`ã€`_.insert`ã€`_.remove`ï¼ˆå®˜æ–¹æ¨èä½¿ç”¨ `_.insert` è€Œé `_.assign`ï¼‰
2. **æ•°æ®ç»“æ„ä¿æŠ¤**ï¼šé€šè¿‡ `$meta` å’Œ `$__META_EXTENSIBLE__$` å®ç°æ¨¡å¼æ ¡éªŒ
3. **æ•°å­¦è¿ç®—**ï¼šé›†æˆ `math.js` åº“ï¼Œæ”¯æŒå¤æ‚è®¡ç®—
4. **è§„èŒƒåŒ–è·¯å¾„**ï¼šæ˜ç¡® `[0]` ç´¢å¼•è§„åˆ™ï¼Œä¿æŠ¤æè¿°ä¿¡æ¯
5. **StrictSet æ¨¡å¼**ï¼šæ›´ä¸¥æ ¼çš„æ•°æ®ç±»å‹æ§åˆ¶

### å‰ç½®è¦æ±‚

åœ¨å­¦ä¹  MVU Beta ä¹‹å‰ï¼Œè¯·ç¡®ä¿ä½ å·²ç»ï¼š
- âœ… é˜…è¯»å¹¶æŒæ¡ [MVU åŸºç¡€æ•™ç¨‹](./1-MVUåŸºç¡€æ•™ç¨‹.md)
- âœ… äº†è§£ JSON æ ¼å¼å’ŒåŸºæœ¬çš„ JavaScript è¯­æ³•
- âœ… ç†Ÿæ‚‰ SillyTavern çš„åŸºæœ¬æ“ä½œ

---

## æ–°å¢çš„å˜é‡æ“ä½œå‘½ä»¤

é™¤äº†ç†Ÿæ‚‰çš„ `_.set`ï¼ŒMVU Beta æ–°å¢äº†ä¸‰ä¸ªè¯­ä¹‰æ›´æ˜ç¡®çš„å‘½ä»¤ï¼Œè®© AI èƒ½æ›´æ¸…æ™°åœ°è¡¨è¾¾å®ƒçš„æ„å›¾ã€‚

### 1. `_.add` - æ•°å€¼å¢å‡

**æ¨èç”¨äºï¼š** æ‰€æœ‰æ•°å€¼å˜æ›´æ“ä½œ

**ä¸ºä»€ä¹ˆæ¨èï¼Ÿ**  
è®© LLM åœ¨ `_.set` å‘½ä»¤ä¸­è‡ªå·±è®¡ç®—æ–°å€¼æ¯”è¾ƒå®¹æ˜“å‡ºé”™ï¼Œæœ‰äº›æ—¶å€™å®ƒæ ¹æœ¬ä¸ä¼šéµå¾ªæè¿°ä¸­å†™çš„å˜åŒ–èŒƒå›´ã€‚

#### è¯­æ³•

```javascript
_.add('è·¯å¾„', å˜åŒ–é‡); // å˜åŒ–é‡å¯ä»¥æ˜¯æ­£æ•°æˆ–è´Ÿæ•°
```

#### ç¤ºä¾‹

```javascript
// gold å¢åŠ  10
_.add('gold[0]', 10);

// health å‡å°‘ 5
_.add('health[0]', -5);

// å¥½æ„Ÿåº¦ +2
_.add('è§’è‰².å¥½æ„Ÿåº¦[0]', 2);
```

**ä¼˜åŠ¿ï¼š**  
AI ä¸å†éœ€è¦è‡ªå·±æ„å»º `_.set('gold', 10, 12);` è¿™æ ·çš„è¡¨è¾¾å¼ï¼Œå¤§å¤§é™ä½äº†å‡ºé”™çš„é£é™©ã€‚

---

### 2. `_.insert` - æ’å…¥å…ƒç´ ï¼ˆâ­ æ¨èï¼‰

> **é‡è¦æç¤ºï¼š** å®˜æ–¹æ¨èä½¿ç”¨ `_.insert` è€Œé `_.assign`ï¼Œè¯­ä¹‰æ›´æ˜ç¡®ï¼

**æ¨èç”¨äºï¼š** å‘æ•°ç»„æˆ–å¯¹è±¡æ·»åŠ æ–°å…ƒç´ 

#### è¯­æ³•

```javascript
// å‘æ•°ç»„æœ«å°¾æ·»åŠ 
_.insert('è·¯å¾„', å€¼);

// å‘æ•°ç»„æŒ‡å®šä½ç½®æ’å…¥
_.insert('è·¯å¾„', ç´¢å¼•, å€¼);

// å‘å¯¹è±¡æ·»åŠ é”®å€¼å¯¹
_.insert('è·¯å¾„', é”®å, å€¼);
```

#### ç¤ºä¾‹

**æ•°ç»„æ“ä½œï¼š**

```javascript
// åœ¨ 'inventory' æ•°ç»„æœ«å°¾æ·»åŠ  'æ–°è·å¾—çš„é’¥åŒ™'
_.insert('inventory[0]', 'æ–°è·å¾—çš„é’¥åŒ™');

// åœ¨ 'inventory' æ•°ç»„çš„ç¬¬ 0 ä¸ªä½ç½®æ’å…¥ 'å¤è€çš„å·è½´'
_.insert('inventory[0]', 0, 'å¤è€çš„å·è½´');
```

**å¯¹è±¡æ“ä½œï¼š**

```javascript
// åœ¨ 'achievements' å¯¹è±¡ä¸­æ·»åŠ ä¸€ä¸ªæ–°çš„æˆå°±
_.insert('achievements', 'FIRST_MEETING', 'ä¸æ‚ çºªçš„åˆæ¬¡ç›¸é‡');

// èˆ°è½½æœºèµ·é£
_.insert('ç¦å»º.èˆ°è½½æœº[0].å·²å‡ç©º', 'ç©ºè­¦-600é¢„è­¦æœº', 1);
```

---

### 3. `_.remove` - åˆ é™¤å…ƒç´ 

**æ¨èç”¨äºï¼š** åˆ é™¤æ•°ç»„æˆ–å¯¹è±¡ä¸­çš„å…ƒç´ 

#### è¯­æ³•

```javascript
// åˆ é™¤æ•´ä¸ªå˜é‡
_.remove('è·¯å¾„');

// ä»æ•°ç»„åˆ é™¤ï¼ˆæŒ‰å€¼æˆ–ç´¢å¼•ï¼‰
_.remove('è·¯å¾„', å€¼æˆ–ç´¢å¼•);

// ä»å¯¹è±¡åˆ é™¤ï¼ˆæŒ‰é”®åæˆ–ç´¢å¼•ï¼‰
_.remove('è·¯å¾„', é”®åæˆ–ç´¢å¼•);
```

#### ç¤ºä¾‹

**åˆ é™¤æ•´ä¸ªå˜é‡ï¼š**

```javascript
// åˆ é™¤ä¸€ä¸ªä¸´æ—¶çš„ä»»åŠ¡æ ‡è®°
_.remove('temp_quest_marker');
```

**ä»æ•°ç»„ä¸­åˆ é™¤ï¼š**

```javascript
// æŒ‰å€¼åˆ é™¤ï¼šä» 'inventory' æ•°ç»„ä¸­åˆ é™¤ 'ç”¨æ‰çš„è¯æ°´'
_.remove('inventory[0]', 'ç”¨æ‰çš„è¯æ°´');

// æŒ‰ç´¢å¼•åˆ é™¤ï¼šåˆ é™¤ç´¢å¼•ä¸º 2 çš„ç‰©å“
_.remove('inventory[0]', 2);
```

**ä»å¯¹è±¡ä¸­åˆ é™¤ï¼š**

```javascript
// æŒ‰é”®ååˆ é™¤
_.remove('achievements', 'FIRST_MEETING');

// æŒ‰æ•°å­—ç´¢å¼•åˆ é™¤
// å¦‚æœ 'achievements' æ˜¯ {"a":1, "b":2, "c":3}ï¼Œä¸‹é¢è¿™è¡Œä¼šåˆ é™¤ "b":2
_.remove('achievements', 1);
```

---

### å‘½ä»¤å¯¹æ¯”æ€»ç»“

| å‘½ä»¤ | ç”¨é€” | å‚æ•° | ç¤ºä¾‹ |
|------|------|------|------|
| `_.set` | æ›¿æ¢å€¼ | 2-3ä¸ª | `_.set('health[0]', 100, 95)` |
| `_.add` | æ•°å€¼å¢å‡ | 2ä¸ª | `_.add('gold[0]', 10)` |
| `_.insert` | æ’å…¥å…ƒç´  | 2-3ä¸ª | `_.insert('items[0]', 'é’¥åŒ™')` |
| `_.remove` | åˆ é™¤å…ƒç´  | 1-2ä¸ª | `_.remove('items[0]', 'è¯æ°´')` |

---

## æ•°æ®ç»“æ„å®‰å…¨

### ä¸ºä»€ä¹ˆéœ€è¦æ•°æ®ç»“æ„ä¿æŠ¤ï¼Ÿ

LLM å¯èƒ½ä¼šè¯¯ç”¨ `_.insert` æˆ– `_.remove` å‘½ä»¤ï¼Œç ´åä½ ç²¾å¿ƒè®¾è®¡çš„æ•°æ®ç»“æ„ï¼š
- âŒ ç»™è§’è‰²å±æ€§æ·»åŠ ä¸€ä¸ªä¸å­˜åœ¨çš„å­—æ®µ
- âŒ åœ¨è§’è‰²æ­»äº¡æ—¶å‘ç™«å°†æ•´ä¸ªè§’è‰²åˆ é™¤
- âŒ ä¿®æ”¹äº†æ ¸å¿ƒæ•°æ®ç»“æ„

### è§£å†³æ–¹æ¡ˆï¼šæ¨¡å¼æ ¡éªŒä¿æŠ¤æœºåˆ¶

é€šè¿‡åœ¨ `[InitVar]` çš„ JSON æ–‡ä»¶ä¸­æ·»åŠ ç‰¹æ®Šçš„ `$meta` é”®å’Œ `$__META_EXTENSIBLE__$` æ ‡è®°ï¼Œå‘Šè¯‰ç³»ç»Ÿå“ªäº›éƒ¨åˆ†æ˜¯å›ºå®šçš„ï¼Œå“ªäº›æ˜¯å¯å˜çš„ã€‚

---

### `$meta` å¯¹è±¡é…ç½®

`$meta` å¯¹è±¡æ¥å—å››ä¸ªå±æ€§ï¼š

| å±æ€§ | ç±»å‹ | é»˜è®¤å€¼ | è¯´æ˜ |
|------|------|--------|------|
| `extensible` | boolean | `false` | æ˜¯å¦å…è®¸å¢åˆ é”® |
| `required` | array | `[]` | å¿…éœ€çš„é”®ååˆ—è¡¨ |
| `recursiveExtensible` | boolean | `false` | æ˜¯å¦é€’å½’æ‰©å±•å­å¯¹è±¡ |
| `template` | object/array | `{}` | æ–°å¢å…ƒç´ çš„æ¨¡æ¿ |

---

#### 1. `extensible` - å¯æ‰©å±•æ€§

**`false`ï¼ˆé»˜è®¤ï¼‰ï¼š** é”å®šç»“æ„
- LLM ä¸èƒ½å‘å…¶æ·»åŠ æ–°çš„é”®
- LLM ä¸èƒ½åˆ é™¤å·²æœ‰çš„é”®

**`true`ï¼š** å¼€æ”¾ç»“æ„
- LLM å¯ä»¥ç”¨ `_.insert` æ·»åŠ æ–°é”®
- LLM å¯ä»¥ç”¨ `_.remove` åˆ é™¤é”®
- è¯¥å±‚ä¸‹çš„æ‰€æœ‰å­å…ƒç´ çš„ `required` å±æ€§éƒ½è¢«è®¾ç½®ä¸º `false`ï¼ˆé™¤éåœ¨ `required` æ•°ç»„ä¸­å¦è¡ŒæŒ‡å®šï¼‰

**ç¤ºä¾‹ï¼š**

```json
{
  "$meta": { "extensible": false },  // é”å®šé¡¶å±‚ç»“æ„
  "è§’è‰²": {
    "å¥½æ„Ÿåº¦": [0, "æè¿°"]
  }
}
```

---

#### 2. `required` - å¿…éœ€å­—æ®µ

**ä½œç”¨ï¼š** ä¿æŠ¤å…³é”®å­—æ®µï¼Œä¸èƒ½è¢« `_.remove` åˆ é™¤

**ç¤ºä¾‹ï¼š**

```json
{
  "$meta": {
    "extensible": true,
    "required": ["ç”²", "ä¹™"]  // ç”²å’Œä¹™ä¸å¯åˆ é™¤
  },
  "ç”²": {
    "çŠ¶æ€A": [0, "æè¿°..."],
    "çŠ¶æ€B": [0, "æè¿°..."]
  },
  "ä¹™": {
    "çŠ¶æ€A": [0, "æè¿°..."],
    "çŠ¶æ€B": [0, "æè¿°..."]
  },
  "ä¸™": {  // ä¸™å¯ä»¥è¢«åˆ é™¤
    "çŠ¶æ€A": [0, "æè¿°..."],
    "çŠ¶æ€B": [0, "æè¿°..."]
  }
}
```

---

#### 3. `recursiveExtensible` - é€’å½’æ‰©å±•

**ä½œç”¨ï¼š** è¿™ä¸ªå¯¹è±¡çš„æ‰€æœ‰å­å­™å¯¹è±¡éƒ½å¯æ‰©å±•ï¼ˆç©¿é€æ€§ï¼‰

**ç¤ºä¾‹ï¼š** ç±» Unix æ–‡ä»¶ç³»ç»Ÿ

```json
{
  "/": {
    "$meta": {
      "recursiveExtensible": true  // æ‰€æœ‰å­ç›®å½•éƒ½å¯æ‰©å±•
    },
    "home": {
      "alice": {
        "notes.txt": "document",
        "photos": {}
      }
    },
    "etc": {
      "passwd": "file"
    },
    "var": {}
  }
}
```

---

#### 4. `template` - æ¨¡æ¿

**ä½œç”¨ï¼š** LLM ä½¿ç”¨ `_.insert` æ·»åŠ æ–°ç»“æ„æ—¶ï¼Œè‡ªåŠ¨åˆå¹¶è¿™ä¸ªæ¨¡æ¿

**ç¤ºä¾‹ï¼š**

```json
{
  "VTuberè§’è‰²": {
    "$meta": {
      "extensible": true,
      "template": {
        "äººæ°”å€¼": [0, "ç²‰ä¸æ•°é‡ä¸çŸ¥ååº¦"],
        "æ‰è‰ºæ°´å¹³": [20, "ç»¼åˆæŠ€èƒ½è¯„åˆ†"],
        "å‡ºé“çŠ¶æ€": ["ç­¹å¤‡ä¸­", "è§’è‰²å‘å±•é˜¶æ®µ"]
      }
    }
  }
}
```

å½“ LLM æ·»åŠ æ–° VTuber æ—¶ï¼Œä¼šè‡ªåŠ¨åŒ…å«è¿™äº›å­—æ®µã€‚

---

### `$__META_EXTENSIBLE__$` æ•°ç»„æ‰©å±•æ ‡è®°

**ä½œç”¨ï¼š** æ ‡è®°æ•°ç»„ä¸ºå¯æ‰©å±•

**é»˜è®¤ï¼š** æ‰€æœ‰æ•°ç»„çš„ç»“æ„éƒ½æ˜¯**é”å®šçš„**

**ä½¿ç”¨æ–¹æ³•ï¼š** åœ¨æ•°ç»„ä¸­ä»»æ„ä½ç½®æ·»åŠ  `"$__META_EXTENSIBLE__$"` å­—ç¬¦ä¸²

**ç¤ºä¾‹ï¼š**

```json
{
  "ç€è£…": [
    [
      "$__META_EXTENSIBLE__$",  // æ ‡è®°ä¸ºå¯æ‰©å±•
      "è¡¬è¡«",
      "çŸ­è£¤"
    ],
    "ç€è£…å˜åŒ–æ—¶æ›´æ–°"
  ]
}
```

**æ¸…ç†ï¼š** åœ¨ä¸–ç•Œä¹¦åˆå§‹åŒ–å®Œæˆåï¼Œ`$__META_EXTENSIBLE__$` ä¼šè¢«è‡ªåŠ¨ç§»é™¤ï¼Œä¸ä¼šå ç”¨ Tokenã€‚

---

### å®Œæ•´ç¤ºä¾‹ï¼šèˆªæ¯èˆ°è½½æœºç³»ç»Ÿ

#### åˆå§‹åŒ–é…ç½®

```json
{
  "$meta": { "extensible": false },  // é”å®šé¡¶å±‚
  "ç¦å»º": {
    "èˆ°èˆ¹çŠ¶æ€": ["èˆªè¡Œ", "èˆ°èˆ¹çŠ¶æ€å˜åŒ–æ—¶æ›´æ–°"],
    "èˆ°èˆ¹æ­¦å¤‡": [
      ["$__META_EXTENSIBLE__$", "æµ·çº¢æ——10é˜²ç©ºå¯¼å¼¹", "1130è¿‘é˜²ç‚®"],
      "èˆ°èˆ¹æ­¦å¤‡å˜åŒ–æ—¶æ›´æ–°"
    ],
    "èˆ°è½½æœº": [{
      "å·²å‡ç©º": {
        "$meta": { "extensible": true }
      },
      "å¯éƒ¨ç½²": {
        "$meta": { "extensible": true },
        "æ­¼-35éšèº«æˆ˜æ–—æœº": 6,
        "æ­¼-15Tå¤šç”¨é€”æˆ˜æ–—æœº": 6,
        "æ”»å‡»-11éšèº«æ— äººæœº": 6,
        "ç©ºè­¦-600é¢„è­¦æœº": 1,
        "æ­¼-15Dç”µå­æˆ˜æœº": 2,
        "ç›´-20Sç›´å‡æœº": 2
      },
      "è¡¥ç»™ä¸­": {
        "$meta": { "extensible": true },
        "æ­¼-35éšèº«æˆ˜æ–—æœº": 6,
        "æ­¼-15Tå¤šç”¨é€”æˆ˜æ–—æœº": 6,
        "æ”»å‡»-11éšèº«æ— äººæœº": 10,
        "ç©ºè­¦-600é¢„è­¦æœº": 2,
        "æ­¼-15Dç”µå­æˆ˜æœº": 2,
        "ç›´-20Sç›´å‡æœº": 4
      }
    }, "èˆ°è½½æœºçŠ¶æ€å˜åŒ–æˆ–æ¢è£…æ–°è£…å¤‡æ—¶æ›´æ–°"]
  }
}
```

#### åˆå§‹åŒ–åçš„ `stat_data`

```json
{
  "ç¦å»º": {
    "èˆ°èˆ¹çŠ¶æ€": ["èˆªè¡Œ", "èˆ°èˆ¹çŠ¶æ€å˜åŒ–æ—¶æ›´æ–°"],
    "èˆ°èˆ¹æ­¦å¤‡": [
      ["æµ·çº¢æ——10é˜²ç©ºå¯¼å¼¹", "1130è¿‘é˜²ç‚®"],  // $__META_EXTENSIBLE__$ è¢«ç§»é™¤
      "èˆ°èˆ¹æ­¦å¤‡å˜åŒ–æ—¶æ›´æ–°"
    ],
    "èˆ°è½½æœº": [{
      "å·²å‡ç©º": {},  // $meta è¢«ç§»é™¤
      "å¯éƒ¨ç½²": {
        "æ­¼-35éšèº«æˆ˜æ–—æœº": 6,
        "æ­¼-15Tå¤šç”¨é€”æˆ˜æ–—æœº": 6,
        "æ”»å‡»-11éšèº«æ— äººæœº": 6,
        "ç©ºè­¦-600é¢„è­¦æœº": 1,
        "æ­¼-15Dç”µå­æˆ˜æœº": 2,
        "ç›´-20Sç›´å‡æœº": 2
      },
      "è¡¥ç»™ä¸­": {
        "æ­¼-35éšèº«æˆ˜æ–—æœº": 6,
        "æ­¼-15Tå¤šç”¨é€”æˆ˜æ–—æœº": 6,
        "æ”»å‡»-11éšèº«æ— äººæœº": 10,
        "ç©ºè­¦-600é¢„è­¦æœº": 2,
        "æ­¼-15Dç”µå­æˆ˜æœº": 2,
        "ç›´-20Sç›´å‡æœº": 4
      }
    }, "èˆ°è½½æœºçŠ¶æ€å˜åŒ–æˆ–æ¢è£…æ–°è£…å¤‡æ—¶æ›´æ–°"]
  }
}
```

#### åˆæ³•æ“ä½œ âœ…

```javascript
// èµ·é£ä¸€æ¶ç©ºè­¦-600
_.insert('ç¦å»º.èˆ°è½½æœº[0].å·²å‡ç©º', 'ç©ºè­¦-600é¢„è­¦æœº', 1);

// æ‰€æœ‰å¾…éƒ¨ç½²çš„ç©ºè­¦-600å·²èµ·é£ï¼Œåˆ é™¤æ­¤é”®
_.remove('ç¦å»º.èˆ°è½½æœº[0].å¯éƒ¨ç½²', 'ç©ºè­¦-600é¢„è­¦æœº');

// æ·»åŠ æ­¦å¤‡
_.insert('ç¦å»º.èˆ°èˆ¹æ­¦å¤‡[0]', 'çº¢æ——-9é˜²ç©ºå¯¼å¼¹');
```

#### éæ³•æ“ä½œ âŒ

```javascript
// âŒ æ·»åŠ "ç»´ä¿®ä¸­"çŠ¶æ€ï¼ˆèˆ°è½½æœº[0]ä¸å¯æ‰©å±•ï¼‰
_.insert('ç¦å»º.èˆ°è½½æœº[0]', {"ç»´ä¿®ä¸­": {}});

// âŒ åˆ é™¤"å¯éƒ¨ç½²"çŠ¶æ€ï¼ˆrequired = trueï¼‰
_.remove('ç¦å»º.èˆ°è½½æœº[0].å¯éƒ¨ç½²');

// âŒ æ·»åŠ è¾½å®èˆ°ï¼ˆé¡¶å±‚ä¸å¯æ‰©å±•ï¼‰
_.insert('', "è¾½å®", {});

// âŒ åˆ é™¤ç¦å»ºèˆ°ï¼ˆé¡¶å±‚ä¸å¯æ‰©å±•ï¼‰
_.remove('ç¦å»º');
```

---

### å¤æ‚æƒ…å†µï¼šåŠ¨æ€æ·»åŠ æ–°è§’è‰²

å¦‚æœä½ éœ€è¦å…è®¸åœ¨æ ¹èŠ‚ç‚¹æ·»åŠ æ–°è§’è‰²ï¼Œä½†ä½ çš„è§’è‰²å˜é‡ä¸­åŒ…å«å¯å˜ç»“æ„ï¼Œé‚£ä½ éœ€è¦æç¤º LLM åœ¨æ·»åŠ æ–°è§’è‰²æ—¶ï¼Œåœ¨å¯¹åº”çš„å¯å˜ç»“æ„ä¸­è®¾ç½® `$meta` æˆ– `$__META_EXTENSIBLE__$`ã€‚

**ç¤ºä¾‹ï¼š** æ·»åŠ æ–°èˆ°èˆ¹

```javascript
_.insert('', 'è¾½å®', {
  "èˆ°èˆ¹çŠ¶æ€": ["åœæ³Š", "æè¿°..."],
  "èˆ°èˆ¹æ­¦å¤‡": [
    [
      "æµ·çº¢æ——10é˜²ç©ºå¯¼å¼¹",
      "1130è¿‘é˜²ç‚®",
      "$__META_EXTENSIBLE__$"  // æ ‡è®°æ­¦å¤‡å¯æ‰©å±•
    ],
    "æè¿°..."
  ],
  "èˆ°è½½æœº": [
    {
      "å·²å‡ç©º": {
        "$meta": { "extensible": true }  // æ ‡è®°å¯æ‰©å±•
      },
      "å¯éƒ¨ç½²": {
        "$meta": { "extensible": true },
        "æ­¼-15": 12
      },
      "è¡¥ç»™ä¸­": {
        "$meta": { "extensible": true },
        "æ­¼-15": 12
      }
    },
    "æè¿°..."
  ]
});
```

**æ³¨æ„ï¼š** è¿™éœ€è¦åœ¨æç¤ºè¯çš„ `example` éƒ¨åˆ†æ˜ç¡®è¯´æ˜ã€‚

---

## æ•°å­¦è¿ç®—æ”¯æŒ

### ä¸ºä»€ä¹ˆéœ€è¦æ•°å­¦è¿ç®—ï¼Ÿ

æœ‰æ—¶ LLM æ›´æ–°å˜é‡æ—¶ä¼šé£™å‡ºä¸€å¥è¡¨è¾¾å¼ï¼Œä»¥å‰è¿™ç§æ“ä½œä¼šè®©å˜é‡ç›´æ¥çˆ†ç‚¸ï¼ˆæ•°å€¼å˜é‡å˜æˆå­—ç¬¦ä¸²ï¼‰ã€‚MVU Beta é›†æˆäº† `math.js` åº“ï¼Œå¯ä»¥å®‰å…¨åœ°æ‰§è¡Œå¤æ‚çš„è®¡ç®—ã€‚

---

### åŸºç¡€è¿ç®—

```javascript
// åŸºç¡€ç®—æœ¯
_.set('æ‚ çºª.å¥½æ„Ÿåº¦[0]', 10, 10 + 2);
_.set('æ‚ çºª.å¥½æ„Ÿåº¦[0]', 10, 10 * 1.5);
```

---

### é«˜çº§å‡½æ•°

```javascript
// æŒ‡æ•°ã€å¹‚è¿ç®—
_.set('æ‚ çºª.å¥½æ„Ÿåº¦[0]', 10, math.pow(2, 3) + math.sin(math.PI));

// ä¸‰è§’å‡½æ•°
_.set('æ‚ çºª.å¥½æ„Ÿåº¦[0]', 10, math.sin(math.PI / 2));

// å¾®ç§¯åˆ†
_.set('æ‚ çºª.å¥½æ„Ÿåº¦[0]', 10, math.integrate('x^2', 'x', 0, 1));
```

---

### å¤æ•°å’ŒçŸ©é˜µ

```javascript
// å¤æ•°è¿ç®—
_.set('æ‚ çºª.å¥½æ„Ÿåº¦[0]', 10, math.complex(2, 3).add(math.complex(1, -1)));

// çŸ©é˜µè¿ç®—
_.set('æ‚ çºª.å¥½æ„Ÿåº¦[0]', 10, math.matrix([[1, 2], [3, 4]]).multiply(math.matrix([[5], [6]])));
```

> **æ³¨æ„ï¼š** è¿™äº›åªæ˜¯ç¤ºä¾‹ã€‚å®é™…ä½¿ç”¨ä¸­ï¼Œä½ æ²¡å¿…è¦è¦æ±‚ LLM ä½¿ç”¨è¿™ä¹ˆå¤æ‚çš„æ•°å­¦è¡¨è¾¾å¼ï¼Œé™¤éä½ çœŸçš„éœ€è¦å®ƒæ¥è®¡ç®—æŸäº›å¤æ‚çš„æ•°å€¼ã€‚

---

### å­—ç¬¦ä¸²ä¿æŠ¤

**é‡è¦ï¼š** å¸¦å¼•å·çš„å­—ç¬¦ä¸²ä¸ä¼šè¢«å½“ä½œæ•°å­¦è¡¨è¾¾å¼å¤„ç†

```javascript
// âœ… è¿™æ˜¯å­—ç¬¦ä¸²ï¼Œä¸ä¼šè¢«è®¡ç®—
_.set('å½“å‰æ—¥æœŸ[0]', '2000-01-01');

// âŒ è¿™ä¼šè¢«è®¡ç®—æˆ 1998
_.set('å½“å‰æ—¥æœŸ[0]', 2000-01-01);
```

---

## [value, description] ç»“æ„è§„èŒƒ

### æ ¸å¿ƒè§„åˆ™

**å½“è¦æ“ä½œçš„å€¼æœ¬èº«æ˜¯ä¸€ä¸ªå¯¹è±¡æˆ–æ•°ç»„æ—¶ï¼Œå¿…é¡»åœ¨è·¯å¾„ä¸­ä½¿ç”¨ `[0]` æ¥æ˜ç¡®æŒ‡å®šè¦æ“ä½œçš„æ˜¯"å€¼"æœ¬èº«ã€‚**

---

### ç¤ºä¾‹ï¼šæ“ä½œèˆ°è½½æœº

#### æ•°æ®ç»“æ„

```json
{
  "stat_data": {
    "ç¦å»º": {
      "èˆ°è½½æœº": [{
        "è¡¥ç»™ä¸­": {
          "J-35": 8
        },
        "å¯éƒ¨ç½²": {
          "J-35": 8
        }
      }, "æè¿°æ–‡æœ¬"]
    }
  }
}
```

#### æ­£ç¡®æ“ä½œ âœ…

```javascript
// ç²¾å‡†å®šä½åˆ°èˆ°è½½æœºçš„æ•°æ®å¯¹è±¡ [0]ï¼Œç„¶åä¿®æ”¹å…¶å†…éƒ¨çš„å€¼
_.set('ç¦å»º.èˆ°è½½æœº[0].è¡¥ç»™ä¸­.J-35', 8, 9);

// ç²¾å‡†å®šä½åˆ°"å¯éƒ¨ç½²"åˆ—è¡¨ï¼Œç„¶åæ’å…¥æ–°é£æœº
_.insert('ç¦å»º.èˆ°è½½æœº[0].å¯éƒ¨ç½²', 'J-15T', 12);
```

#### é”™è¯¯æ“ä½œ âŒ

```javascript
// âŒ è¿™ä¸ªè·¯å¾„æ˜¯æ— æ•ˆçš„ï¼Œå˜é‡ä¸ä¼šæœ‰ä»»ä½•å˜åŒ–
_.set('ç¦å»º.èˆ°è½½æœº.è¡¥ç»™ä¸­.J-35', 8, 9);

// âŒ è¿™ä¸ªæ“ä½œå› ä¸ºå°è¯•æ±¡æŸ“æ•°æ®ç»“æ„ï¼Œä¼šè¢«å±è”½æ‰
_.insert('ç¦å»º.èˆ°è½½æœº.è¡¥ç»™ä¸­', 'J-15T', 8);
```

---

### ä¾¿åˆ©çš„å¿«æ·æ–¹å¼ï¼ˆä»…é™ç®€å•å€¼ï¼‰

ä¸ºäº†ä¿è¯å¯¹è€å¡çš„å…¼å®¹æ€§ï¼Œå½“ä½¿ç”¨ `_.set` æˆ– `_.add` æ“ä½œ**ç®€å•å€¼**ï¼ˆå­—ç¬¦ä¸²ã€æ•°å­—ã€å¸ƒå°”å€¼ï¼‰æ—¶ï¼Œå¯ä»¥çœç•¥ `[0]`ã€‚

```javascript
// è¿™ä¸¤ç§å†™æ³•éƒ½èƒ½å®‰å…¨å·¥ä½œ
_.set('ç»å†å¤©æ•°', 1);
_.set('ç»å†å¤©æ•°[0]', 1);
```

> **å¼ºçƒˆå»ºè®®ï¼š** åœ¨ç¼–å†™æç¤ºè¯å¼•å¯¼ LLM æ—¶ï¼Œè¦æ±‚å®ƒå§‹ç»ˆä½¿ç”¨å¸¦ `[0]` çš„ç²¾ç¡®è·¯å¾„ã€‚è¿™æ˜¯ä¸€ç§æ›´ä¸¥è°¨ã€æ›´ä¸ä¼šå‡ºé”™çš„æ–¹æ³•ã€‚

**æ³¨æ„ï¼š** `_.insert` å’Œ `_.remove` ä¸æ”¯æŒå¿«æ·è¾“å…¥ï¼Œå¿…é¡»ä½¿ç”¨ç²¾ç¡®è·¯å¾„ã€‚

---

## æ¨èçš„æç¤ºè¯æ¨¡æ¿

ä¸ºäº†è®© LLM æ›´å¥½åœ°ç†è§£å¹¶ä½¿ç”¨ MVU Beta çš„æ–°åŠŸèƒ½ï¼Œè¿™é‡Œæä¾›äº†ä¸€ä»½æ¨èçš„æç¤ºè¯æ¨¡æ¿ã€‚

### å®Œæ•´æ¨¡æ¿

```ejs
<%_ setLocalVar('initialized_lorebooks.-SnowYuki[0]', true); _%>
{{// è¿™ä¸ªå€¼æ˜¯ç”¨æ¥åˆ¤åˆ«ä¸–ç•Œä¹¦æ˜¯å¦åˆå§‹åŒ–çš„ï¼Œåœ¨ä¸–ç•Œä¹¦åŠ è½½ä¸€æ¬¡ä¹‹åå°±æ°¸ä¹…ä¸ºtrue}}
{{// å¯ä»¥åœ¨æŸäº›å˜é‡éœ€è¦å±è”½æ¥è‡ªLLMçš„æ›´æ–°æ—¶ä½¿ç”¨ï¼Œé¿å…å°†åˆå§‹åŒ–è®¾ç½®ä¹Ÿå±è”½æ‰}}
{{// ä¸è¦ä½¿ç”¨setvarï¼Œä¼šæ’å…¥åˆ°ç”¨æˆ·æ¶ˆæ¯å˜é‡ä¸­å¯¼è‡´æ¶ˆæ¯swipeå‡ºé”™}}

ã€å˜é‡æ›´æ–°ã€‘
åœ¨æ‰€æœ‰æ–‡æœ¬çš„æœ€åï¼Œè¿›è¡Œå˜é‡æ›´æ–°ã€‚
ä»¥ä¸‹æ˜¯æ•…äº‹ä¸­éœ€è¦è¿½è¸ªçš„å…³é”®å˜é‡ï¼Œå½“å‰çŠ¶æ€ä»¥è¿™äº›å˜é‡çš„å€¼ä¸ºå‡†ã€‚

<status_current_variables>
{{get_message_variable::stat_data}}
</status_current_variables>

ä¸¥æ ¼æŒ‰ç…§ä»¥ä¸‹è§„åˆ™å’Œæ ¼å¼è¿›è¡Œè¾“å‡ºï¼Œå¹¶ç¡®å®šæ¯ä¸€ä¸ªå˜é‡æ˜¯å¦éœ€è¦æ›´æ–°ï¼Œä¸è¦é—æ¼ï¼š

rule:
  description:
    - You should output the update analysis in the end of the next response, following the variables list defined in <status_current_variables> section which will be provided by the previous turn.
    - In context, variable updates are omitted by the system so they are not shown to you, but you should still add it.
    - There are 4 commands can be used to adjust the data: `_.set`, `_.insert`, `_.remove` and `_.add`.
    - to set a certain value, use `_.set`, it supports 2 or 3 input args.
    - to insert something into an array or object, use `_.insert` (recommended, better semantics), it supports 2 or 3 input args.
    - to delete something from an object/array, use `_.remove`, it supports 1 or 2 input args.
    - If you need to insert or remove multiple values, use `_.insert` or `_.remove` multiple times, not in a single command.
    - to add a delta to a number, use `_.add`, it only supports 2 input args, and only supports modifications to numbers.
    - It is allowed to use math expressions for number inputs.
  
  analysis:
    - You must rethink what variables are defined in the previous <status_current_variables> property, and analyze how to update each of them accordingly.
    - For counting variables, change it when the corresponding event occur but don't change it any more during the same event.
    - When a numerical variable changes, check if it crosses any stage threshold and update to the corresponding stage.
    - If dest element is in an array with description, **PRECISELY** locate the element by adding "[0]" suffix. DO NOT change the description.
  
  format: |-
    <UpdateVariable>
        <Analysis>$(IN ENGLISH$)
            - calculate time passed: ...
            - decide whether dramatic updates are allowed as it's in a special case or the time passed is more than usual: yes or no
            - list every variable in `<status_current_variables>` section...
            - Check the description of this variable and analyze whether it satisfies its change conditions, do not output reason:...
            - Ignore summary related content when evaluate.
            ...
        </Analysis>
        _.set('${path}', ${old}?, ${new});//${reason}
        _.insert('${path}', ${key_or_index}?, ${value});//${reason}
        _.remove('${path}', ${key_or_index_or_value}?);//${reason}
        _.add('${path}', ${delta});//${reason}
    </UpdateVariable>
  
  example: |-
    <UpdateVariable>
        <Analysis>
            å½“å‰æ—¶é—´[0]: Y
            æ‚ çºª.å¥½æ„Ÿåº¦[0]: Y
            æ‚ çºª.é‡è¦æˆå°±[0]: Y
            æ‚ çºª.ç€è£…[0]: Y
            ...
        </Analysis>
        _.set('å½“å‰æ—¶é—´[0]', '2026-6-1 10:05', '2026-6-1 10:15');//æ—¶é—´æµé€
        _.add('æ‚ çºª.å¥½æ„Ÿåº¦[0]', 2);//ä¸æ‚ çºªçš„å¥½æ„Ÿåº¦å¢åŠ 
        _.insert('æ‚ çºª.é‡è¦æˆå°±[0]', '2026å¹´6æœˆ1æ—¥ï¼Œæ‚ çºªå¯¹<user>å‘Šç™½æˆåŠŸ');//æ‚ çºªå¯¹<user>æˆåŠŸå‘Šç™½
        _.remove('æ‚ çºª.ç€è£…[0]', 'ç²‰è‰²ç¼å¸¦');//æ‚ çºªè„±ä¸‹ç²‰è‰²ç¼å¸¦
    </UpdateVariable>
```

### é‡è¦æç¤º

**å…³äºæ•°å­¦è¡¨è¾¾å¼ï¼š**

`- It is allowed to use math expressions for number inputs.` è¿™ä¸€è¡Œå¯èƒ½ä¼šèµ·åæ•ˆæœã€‚å®é™…ä½¿ç”¨è¿‡ç¨‹ä¸­èƒ½å…¼å®¹ LLM å¶å°”å‘ç™«é£™å‡ºæ¥çš„è¡¨è¾¾å¼å°±è¡Œäº†ã€‚

å¦‚æœä½ æ˜ç¡®éœ€è¦ LLM å†™è¡¨è¾¾å¼ï¼Œè¯·åœ¨ `example` çš„ç”¨ä¾‹ä¸­æ˜ç¡®æç¤ºï¼Œè®© LLM åˆ«åŠ å¼•å·ï¼Œä¸ç„¶è¢«åˆ¤å®šæˆå­—ç¬¦ä¸²å°±æ˜¯æ— æ•ˆè¾“å…¥äº†ã€‚

---

## StrictSet é…ç½®

### ä»€ä¹ˆæ˜¯ StrictSetï¼Ÿ

åœ¨åŸæœ¬çš„ MVU ä¸­ï¼Œä½¿ç”¨äº† ValueWithDescription (VWD) è¯­ä¹‰ï¼š

- å°†ä¸€ä¸ªå¤§å°æ­£å¥½ä¸º 2ï¼Œç¬¬äºŒä¸ªå…ƒç´ ä¸º `string` ç±»å‹çš„æ•°ç»„è§†ä¸ºä¸€ä¸ª `å€¼-å˜æ›´æ¡ä»¶` å¯¹

### é»˜è®¤è¡Œä¸ºï¼ˆVWD æ¨¡å¼ï¼‰

```json
{
  "ç”Ÿå‘½": [20, "å—åˆ°ä¼¤å®³æ—¶å‡å°‘"]
}
```

**æ“ä½œï¼š** `_.set('ç”Ÿå‘½', 14);`  
**ç»“æœï¼š** `"ç”Ÿå‘½": [14, "å—åˆ°ä¼¤å®³æ—¶å‡å°‘"]`ï¼ˆä¿ç•™æè¿°ï¼‰

**æ“ä½œï¼š** `_.set('ç”Ÿå‘½', [14, 'æˆ‘å¸¦ä½ æ‰“']);`  
**ç»“æœï¼š** `"ç”Ÿå‘½": [[14, 'æˆ‘å¸¦ä½ æ‰“'], "å—åˆ°ä¼¤å®³æ—¶å‡å°‘"]`ï¼ˆåµŒå¥—æ•°ç»„ï¼‰

**ç›®çš„ï¼š** é¿å… LLM å‘ç™«æ—¶ç ´åå˜æ›´æ¡ä»¶ã€‚

### StrictSet æ¨¡å¼

ä½†æ˜¯è¿™ç§åšæ³•ä¼šå½±å“éƒ¨åˆ†å¯¹æ•°ç»„çš„æ­£å¸¸èµ‹å€¼ã€‚å› æ­¤ MVU Beta æä¾›äº† `strictSet` é…ç½®é¡¹ï¼š

```json
{
  "$meta": {
    "strictSet": true
  },
  "ç”Ÿå‘½": [20, "å—åˆ°ä¼¤å®³æ—¶å‡å°‘"]
}
```

**é…ç½®åï¼š**

**æ“ä½œï¼š** `_.set('ç”Ÿå‘½', 14);`  
**ç»“æœï¼š** `"ç”Ÿå‘½": 14`ï¼ˆç›´æ¥æ›¿æ¢æ•´ä¸ªå€¼ï¼‰

**æ“ä½œï¼š** `_.set('ç”Ÿå‘½[0]', 14);`  
**ç»“æœï¼š** `"ç”Ÿå‘½": [14, "å—åˆ°ä¼¤å®³æ—¶å‡å°‘"]`ï¼ˆä¿ç•™æè¿°ï¼‰

**å»ºè®®ï¼š**  
è®¾ç½® `strictSet: true`ï¼Œå¹¶å§‹ç»ˆä½¿ç”¨ `[0]` ç´¢å¼•ï¼Œè¿™æ ·æ›´ä¸¥è°¨ã€‚

---

## å®Œæ•´æ ¼å¼è¯´æ˜

### æ–‡ä»¶å‘½å

æ–‡ä»¶åå¿…é¡»åŒ…å« `[InitVar]`ã€‚

---

### `stat_data` æ ¹èŠ‚ç‚¹è§„åˆ™

**âš ï¸ é‡è¦ï¼š** ç³»ç»Ÿä¼šè‡ªåŠ¨åœ¨å¤–å±‚æ·»åŠ  `stat_data` å®¹å™¨ï¼ŒInitVar æ–‡ä»¶é‡Œä¸éœ€è¦æ‰‹å†™ï¼

#### âŒ é”™è¯¯å†™æ³•ï¼ˆå¥—ä¸¤å±‚ï¼‰

```json
{
  "stat_data": {     // âŒ ä¸è¦å†™è¿™å±‚ï¼
    "$meta": { ... },
    "é¾™è™ç³»ç»Ÿ": { ... }
  }
}
```

**ç»“æœï¼š** å¥—ä¸¤å±‚ `stat_data`ï¼Œå˜é‡æ— æ³•è®¿é—®

```
stat_data (ç³»ç»Ÿè‡ªåŠ¨æ·»åŠ )
  â””â”€ stat_data (æ‰‹å†™çš„ï¼Œé‡å¤äº†ï¼)
      â””â”€ é¾™è™ç³»ç»Ÿ
```

#### âœ… æ­£ç¡®å†™æ³•

```json
{
  "$meta": { ... },
  "é¾™è™ç³»ç»Ÿ": {
    "æ•Œæ„": [100, "æè¿°"]
  },
  "è™ç§‹çŠ¶æ€": {
    "å½“å‰å½¢æ€": ["åŠè™å½¢æ€", "æè¿°"]
  }
}
```

**ç»“æœï¼š** æ­£å¸¸çš„ç»“æ„

```
stat_data (â† ç³»ç»Ÿè‡ªåŠ¨æ·»åŠ )
  â”œâ”€ é¾™è™ç³»ç»Ÿ
  â””â”€ è™ç§‹çŠ¶æ€
```

---

### è®¿é—®è§„åˆ™æ€»ç»“

| æ“ä½œ | æ˜¯å¦å†™ stat_data | ç¤ºä¾‹ |
|------|------------------|------|
| AI æ›´æ–° | âŒ ä¸å†™ | `_.set('é¾™è™ç³»ç»Ÿ.æ•Œæ„[0]', 100, 95)` |
| EJS è¯»å– | âœ… å¿…é¡»å†™ | `getvar('stat_data.é¾™è™ç³»ç»Ÿ.æ•Œæ„[0]')` |
| ä¸–ç•Œä¹¦æ˜¾ç¤º | âœ… å›ºå®šå†™æ³• | `{{get_message_variable::stat_data}}` |

---

### å˜é‡å®šä¹‰æ ¼å¼

#### åŸºæœ¬æ ¼å¼

```json
{
  "å˜é‡å": [åˆå§‹å€¼, "å˜æ›´æ¡ä»¶æˆ–è¯´æ˜"]
}
```

- `[0]`ï¼šå˜é‡çš„å€¼
- `[1]`ï¼šå˜é‡çš„è¯´æ˜ï¼ˆä¾› AI å‚è€ƒï¼‰

---

#### å€¼ç±»å‹

**æ•°å€¼å‹ï¼š**

```json
{
  "å¥½æ„Ÿåº¦": [0, "[-30,100]ä¹‹é—´ï¼Œä¸è§’è‰²äº¤æµæ—¶å˜åŒ–"],
  "é‡‘å¸": [1000, "è´­ä¹°ç‰©å“æ—¶å‡å°‘ï¼Œå®Œæˆä»»åŠ¡æ—¶å¢åŠ "]
}
```

**å­—ç¬¦ä¸²å‹ï¼š**

```json
{
  "å½“å‰ä½ç½®": ["æ•™å ‚", "è§’è‰²ç§»åŠ¨åæ”¹å˜"],
  "å¿ƒæƒ…": ["å¹³é™", "å¹³é™/å¼€å¿ƒ/æ‚²ä¼¤/æ„¤æ€’"]
}
```

**æ•°ç»„å‹ï¼š**

```json
{
  "èƒŒåŒ…": [["é’¥åŒ™", "è¯æ°´"], "è·å¾—æˆ–ä½¿ç”¨ç‰©å“æ—¶æ›´æ–°"],
  "é‡è¦è®°å¿†": [[], "å‘ç”Ÿé‡è¦äº‹ä»¶æ—¶è®°å½•"]
}
```

**å¯¹è±¡å‹ï¼ˆåµŒå¥—ï¼‰ï¼š**

```json
{
  "è§’è‰²": {
    "å§“å": ["å°æ˜", "è§’è‰²åç§°"],
    "ç­‰çº§": [1, "å‡çº§æ—¶æ›´æ–°"]
  }
}
```

---

### åµŒå¥—ç»“æ„

MVU Beta æ”¯æŒå¤šå±‚åµŒå¥—ï¼Œé€‚åˆå¤æ‚æ•°æ®ç»“æ„ã€‚

**äºŒå±‚åµŒå¥—ï¼š**

```json
{
  "user": {
    "èº«ä»½": ["æ–°æ¥çš„ç‰§å¸ˆ", "éšæ•…äº‹è¿›å±•æ”¹å˜"],
    "å½“å‰ä½ç½®": ["æ•™å ‚", "useræ‰€åœ¨ä½ç½®ï¼Œç§»åŠ¨åæ”¹å˜"]
  }
}
```

**ä¸‰å±‚åµŒå¥—ï¼š**

```json
{
  "ç†": {
    "åŸºç¡€å±æ€§": {
      "å¥½æ„Ÿåº¦": [0, "[-30,100]ä¹‹é—´ï¼Œä¸ç†äº¤æµæ—¶å˜åŒ–"],
      "ä¿¡ä»»åº¦": [50, "[0,100]ä¹‹é—´ï¼Œå‘ç”Ÿé‡è¦äº‹ä»¶æ—¶å˜åŒ–"]
    },
    "æƒ…ç»ªçŠ¶æ€": {
      "pleasure": [0.1, "[-1,1]ä¹‹é—´ï¼Œæƒ…ç»ªå˜åŒ–æ—¶æ›´æ–°"],
      "arousal": [0.0, "[-1,1]ä¹‹é—´ï¼Œarousalå˜åŒ–æ—¶æ›´æ–°"]
    }
  }
}
```

---

### è·¯å¾„è§„åˆ™

#### [0] ç´¢å¼•è§„åˆ™

| å€¼ç±»å‹ | æ˜¯å¦éœ€è¦ [0] | è¯´æ˜ |
|--------|-------------|------|
| ç®€å•å€¼ï¼ˆæ•°å­—/å­—ç¬¦ä¸²ï¼‰ | å¯é€‰ï¼ˆä½†æ¨èï¼‰ | `_.set('å¥½æ„Ÿåº¦[0]', 10, 15)` |
| å¤æ‚å€¼ï¼ˆå¯¹è±¡/æ•°ç»„ï¼‰ | **å¿…é¡»** | `_.set('èˆ°è½½æœº[0].å·²å‡ç©º.J-35', 1, 2)` |

**æ­£ç¡®ç¤ºä¾‹ï¼š**

```javascript
// âœ… ç®€å•å€¼
_.set('å¥½æ„Ÿåº¦[0]', 10, 15);

// âœ… å¤æ‚å€¼
_.set('èˆ°è½½æœº[0].è¡¥ç»™ä¸­.J-35', 8, 9);
_.insert('èˆ°è½½æœº[0].å¯éƒ¨ç½²', 'J-15T', 12);
```

**é”™è¯¯ç¤ºä¾‹ï¼š**

```javascript
// âŒ å¤æ‚å€¼ç¼ºå°‘[0]
_.set('èˆ°è½½æœº.è¡¥ç»™ä¸­.J-35', 8, 9);
```

---

## å®æˆ˜ç¤ºä¾‹

### ç¤ºä¾‹ 1ï¼šç®€å•è§’è‰²ç³»ç»Ÿ

```json
{
  "æ—¥æœŸ": ["03æœˆ15æ—¥", "ä»Šå¤©çš„æ—¥æœŸ"],
  "æ—¶é—´": ["09:00", "å½“å‰æ—¶é—´"],
  "user": {
    "èº«ä»½": ["æ–°æ¥çš„ç‰§å¸ˆ", "éšæ•…äº‹è¿›å±•æ”¹å˜"],
    "å½“å‰ä½ç½®": ["æ•™å ‚", "useræ‰€åœ¨ä½ç½®"]
  },
  "ç†": {
    "å¥½æ„Ÿåº¦": [0, "[-30,100]ä¹‹é—´ï¼Œä¸ç†äº¤æµæ—¶å˜åŒ–"],
    "ç€è£…": [
      ["$__META_EXTENSIBLE__$", "ç™½è‰²ä¿®å¥³æœ"],
      "ç€è£…å˜åŒ–æ—¶æ›´æ–°"
    ]
  }
}
```

---

### ç¤ºä¾‹ 2ï¼šVTuber å…¬å¸ç³»ç»Ÿ

```json
{
  "$meta": {
    "extensible": false,
    "strictSet": true
  },
  "å…¬å¸çŠ¶æ€": {
    "$meta": {
      "extensible": false,
      "required": ["èµ„é‡‘æµ", "å½±å“åŠ›"]
    },
    "èµ„é‡‘æµ": [480000, "å…¬å¸å½“å‰å¯ç”¨èµ„é‡‘"],
    "å½±å“åŠ›": [15, "è¡Œä¸šå£°èª‰å€¼ï¼ŒèŒƒå›´0-100"]
  },
  "VTuberè§’è‰²": {
    "$meta": {
      "extensible": true,
      "template": {
        "äººæ°”å€¼": [0, "ç²‰ä¸æ•°é‡ä¸çŸ¥ååº¦"],
        "æ‰è‰ºæ°´å¹³": [20, "ç»¼åˆæŠ€èƒ½è¯„åˆ†"],
        "å‡ºé“çŠ¶æ€": ["ç­¹å¤‡ä¸­", "è§’è‰²å‘å±•é˜¶æ®µ"]
      }
    }
  }
}
```

---

### ç¤ºä¾‹ 3ï¼šæ¸¸æˆèƒŒåŒ…ç³»ç»Ÿ

```json
{
  "$meta": {
    "extensible": false
  },
  "ç©å®¶": {
    "ç­‰çº§": [1, "å‡çº§æ—¶æ›´æ–°"],
    "ç»éªŒå€¼": [0, "æˆ˜æ–—åå¢åŠ "],
    "é‡‘å¸": [1000, "è´­ä¹°ç‰©å“æ—¶å‡å°‘"],
    "èƒŒåŒ…": [
      ["$__META_EXTENSIBLE__$", "æ–°æ‰‹å‰‘", "åˆçº§è¯æ°´"],
      "è·å¾—æˆ–ä½¿ç”¨ç‰©å“æ—¶æ›´æ–°ï¼Œæœ€å¤š20ä¸ª"
    ],
    "è£…å¤‡": {
      "$meta": {
        "extensible": false,
        "required": ["æ­¦å™¨", "é˜²å…·"]
      },
      "æ­¦å™¨": ["æ–°æ‰‹å‰‘", "è£…å¤‡çš„æ­¦å™¨"],
      "é˜²å…·": ["å¸ƒè¡£", "è£…å¤‡çš„é˜²å…·"],
      "é¥°å“": ["", "è£…å¤‡çš„é¥°å“ï¼Œå¯ä¸ºç©º"]
    }
  }
}
```

**åˆæ³•æ“ä½œï¼š**

```javascript
// å‡çº§
_.set('ç©å®¶.ç­‰çº§[0]', 1, 2);
_.add('ç©å®¶.ç»éªŒå€¼[0]', 50);

// è·å¾—ç‰©å“
_.insert('ç©å®¶.èƒŒåŒ…[0]', 'é’¢å‰‘');
_.add('ç©å®¶.é‡‘å¸[0]', -100);

// æ›´æ¢è£…å¤‡
_.set('ç©å®¶.è£…å¤‡.æ­¦å™¨[0]', 'æ–°æ‰‹å‰‘', 'é’¢å‰‘');
```

**éæ³•æ“ä½œï¼š**

```javascript
// âŒ åˆ é™¤å¿…éœ€å­—æ®µ
_.remove('ç©å®¶.è£…å¤‡.æ­¦å™¨');

// âŒ æ·»åŠ æ–°è£…å¤‡æ§½ï¼ˆè£…å¤‡å¯¹è±¡ä¸å¯æ‰©å±•ï¼‰
_.insert('ç©å®¶.è£…å¤‡', 'æˆ’æŒ‡', 'åŠ›é‡æˆ’æŒ‡');
```

---

## å¸¸è§é—®é¢˜è§£ç­”

### Q1: ä¸ºä»€ä¹ˆå˜é‡å¥—äº†ä¸¤å±‚ stat_dataï¼Ÿ

**é—®é¢˜ç°è±¡ï¼š**

```
stat_data
  â””â”€ stat_data (é‡å¤ï¼)
      â””â”€ ä½ çš„å˜é‡ç³»ç»Ÿ
```

**åŸå› ï¼š** åœ¨ InitVar æ–‡ä»¶ä¸­æ‰‹å†™äº† `stat_data` æ ¹èŠ‚ç‚¹ã€‚

**è§£å†³ï¼š** åˆ é™¤æ‰‹å†™çš„ `stat_data`ï¼Œç³»ç»Ÿä¼šè‡ªåŠ¨æ·»åŠ ã€‚

---

### Q2: å¦‚ä½•è®©é¡¶å±‚ç»“æ„å¯ä»¥æ·»åŠ æ–°è§’è‰²ï¼Ÿ

```json
{
  "$meta": {
    "extensible": true,
    "required": ["ä¸»è§’", "å¥³ä¸»"]
  },
  "ä¸»è§’": {
    "å¥½æ„Ÿåº¦": [0, "æè¿°"]
  },
  "é…è§’": {
    "å¥½æ„Ÿåº¦": [0, "å¯ä»¥åˆ é™¤"]
  }
}
```

---

### Q3: `_.insert` å’Œ `_.assign` æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ

**å®˜æ–¹æ¨èä½¿ç”¨ `_.insert`ï¼**

- `_.insert` è¯­ä¹‰æ›´æ˜ç¡®ï¼ˆæ’å…¥æ“ä½œï¼‰
- `_.assign` ä»ç„¶å¯ç”¨ï¼Œä½†ä¸æ¨èï¼ˆèµ‹å€¼è¯­ä¹‰å®¹æ˜“æ··æ·†ï¼‰
- ä¸¤è€…åŠŸèƒ½å®Œå…¨ç›¸åŒï¼Œåªæ˜¯å‘½åä¸åŒ

**å»ºè®®ï¼š** åœ¨æ–°å¡ä¸­ç»Ÿä¸€ä½¿ç”¨ `_.insert`ã€‚

---

### Q4: strictSet æ˜¯ä»€ä¹ˆï¼Ÿ

**ä¸è®¾ç½® `strictSet: true`ï¼š**

```javascript
_.set('ç”Ÿå‘½', 14) â†’ "ç”Ÿå‘½": [14, "å—åˆ°ä¼¤å®³æ—¶å‡å°‘"]
```

**è®¾ç½® `strictSet: true`ï¼š**

```javascript
_.set('ç”Ÿå‘½', 14) â†’ "ç”Ÿå‘½": 14
_.set('ç”Ÿå‘½[0]', 14) â†’ "ç”Ÿå‘½": [14, "å—åˆ°ä¼¤å®³æ—¶å‡å°‘"]
```

**æ¨èï¼š** è®¾ç½® `strictSet: true`ï¼Œå¹¶å§‹ç»ˆä½¿ç”¨ `[0]` ç´¢å¼•ï¼Œæ›´ä¸¥è°¨ã€‚

---

### Q5: å¦‚ä½•åœ¨ä¸åŒå¼€å±€è®¾ç½®ä¸åŒåˆå§‹å€¼ï¼Ÿ

åœ¨é¢å¤–é—®å€™è¯­ä¸­æ·»åŠ  `<UpdateVariable>` æ®µï¼š

```xml
...æ•…äº‹å¼€å¤´...

<UpdateVariable>
_.set('user.èº«ä»½[0]', 'æ–°æ¥çš„ç‰§å¸ˆ');//å¼€å±€è®¾å®š
_.set("ç†.å¥½æ„Ÿåº¦[0]", 15);//å¼€å±€è®¾å®š
</UpdateVariable>
```

---

### Q6: å¦‚ä½•ä½¿ç”¨æ•°å­¦è¡¨è¾¾å¼ï¼Ÿ

MVU Beta æ”¯æŒ **math.js** åº“ï¼š

```javascript
// åŸºç¡€è¿ç®—
_.set('å¥½æ„Ÿåº¦[0]', 10, 10 + 2);

// å¤æ‚è¿ç®—
_.set('å¥½æ„Ÿåº¦[0]', 10, math.pow(2, 3) + math.sin(math.PI));

// æ³¨æ„ï¼šå¸¦å¼•å·çš„æ˜¯å­—ç¬¦ä¸²ï¼Œä¸ä¼šè®¡ç®—
_.set('å½“å‰æ—¥æœŸ[0]', '2000-01-01'); // å­—ç¬¦ä¸²
```

---

### Q7: å¦‚ä½•æ£€æŸ¥å˜é‡çŠ¶æ€ï¼Ÿ

**æ–¹æ³• 1ï¼š** å®‰è£…å˜é‡æŸ¥çœ‹å™¨æ’ä»¶

https://github.com/LenAnderson/SillyTavern-Variable-Viewer/

èŠå¤©æ¡†è¾“å…¥ `/variableviewer`

**æ–¹æ³• 2ï¼š** æŸ¥çœ‹èŠå¤©æ–‡ä»¶

è·¯å¾„ï¼š`SillyTavern/default-user/chats/è§’è‰²å¡åç§°/èŠå¤©æ–‡ä»¶`

ç”¨ VSCode æ‰“å¼€èƒ½çœ‹è§å˜é‡å®æ—¶æ›´æ–°ã€‚

---

### Q8: `$meta` å’Œ `$__META_EXTENSIBLE__$` ä¼šå ç”¨ Token å—ï¼Ÿ

**ä¸ä¼šï¼**

è¿™äº›æ ‡è®°åœ¨åˆå§‹åŒ–å®Œæˆåä¼šè¢«è‡ªåŠ¨ç§»é™¤ï¼Œä¸ä¼šå‡ºç°åœ¨åç»­çš„ `stat_data` ä¸­ï¼Œæ‰€ä»¥ä¸ç”¨æ‹…å¿ƒå ç”¨ Token å’Œæ¨¡å‹æ³¨æ„åŠ›ã€‚

---

### Q9: å¦‚ä½•å®ç°é€’å½’å¯æ‰©å±•ç»“æ„ï¼Ÿ

ä½¿ç”¨ `recursiveExtensible: true`ï¼š

```json
{
  "/": {
    "$meta": {
      "recursiveExtensible": true
    },
    "home": {
      "alice": {
        "notes.txt": "document",
        "photos": {}
      }
    }
  }
}
```

æ‰€æœ‰å­å­™å¯¹è±¡éƒ½å¯æ‰©å±•ï¼Œé™¤éè¢« `"extensible": false` æˆªæ–­ã€‚

---

## ä¸‹ä¸€æ­¥å­¦ä¹ 

å®Œæˆ MVU Beta å­¦ä¹ åï¼Œæ¨èç»§ç»­å­¦ä¹ ï¼š

1. **[EJS å®æˆ˜æŒ‡å—](./3-EJSå®æˆ˜æŒ‡å—.md)** - æŒæ¡åŠ¨æ€ä¸–ç•Œä¹¦å’Œå¤æ‚é€»è¾‘
2. **[AI æç¤ºè¯æ¨¡æ¿](./4-AIæç¤ºè¯æ¨¡æ¿.md)** - è®© AI è‡ªåŠ¨ç®¡ç†å˜é‡

---

## ç›¸å…³èµ„æº

**å®˜æ–¹èµ„æºï¼š**
- **MVU GitHub**: https://github.com/MagicalAstrogy/MagVarUpdate
- **ç¤ºä¾‹ä»£ç **: https://github.com/MagicalAstrogy/MagVarUpdate/tree/master/example_src

**å‚è€ƒè§’è‰²å¡ï¼š**
- åœ£å¥³ç†ç†ï¼šhttps://discord.com/channels/1291925535324110879/1367723727827111998
- å…¶ä»–ç¤ºä¾‹ï¼šhttps://discord.com/channels/1134557553011998840/1381913493774536755

---

**ç¥ä½ åˆ›ä½œæ„‰å¿«ï¼** ğŸ‰

> **æ„Ÿè°¢ï¼š** MagicalAstrogy (MAGè€å¸ˆ)ã€æ³¢æ•°æ¶µè€å¸ˆã€é’ç©ºè‰è€å¸ˆã€ç§‹é’å­

